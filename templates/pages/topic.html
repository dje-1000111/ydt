{% extends 'pages/base.html' %}
{% load static %}
{% load compress %}
{% block title %}{{ topic_name|capfirst }} - {% endblock title %}
{% block head_script %}<script src="{% static 'js/video.js' %}"></script>{% endblock head_script %}
{% block css_container %}<div class="grid-topic-container" id="tcontainer">{% endblock css_container %}
{% block index %}
{% spaceless %}
    <div class="subhead" id="subh">
        {% if messages %}
            {% for message in messages %}
                <div class="m-4 alert {% if message.tags %}alert-{{ message.tags }}{% endif %}" role="alert">{{ message }}</div>
            {% endfor %}
        {% endif %}
        <h2>{{vid_title}} <span id="video-title"></span><i id="ivideo-title"></i></h2>
        {% if user.is_authenticated %}
            <div class="star-rating">
                Level of difficulty : 
                {% for star in stars %}
                    {% if star == star_rating %}
                        <input type="radio" id="{{dictation_id}}_{{star}}" name="rate" value="{{star}}" checked="">
                        <label id="label-{{dictation_id}}_{{star}}" for="{{dictation_id}}_{{star}}" title="rating: {{star}}"></label>  
                    {% else %}
                        <input type="radio" id="{{dictation_id}}_{{star}}" name="rate" value="{{star}}">
                        <label id="label-{{dictation_id}}_{{star}}" for="{{dictation_id}}_{{star}}" title="rating: {{star}}"></label>  
                    {% endif %}    
                {% endfor %} 
            </div>
                <p>As a logged in user you can rate the difficulty of this dictation. You can also continue your progress where you left off last time.<br>Otherwise, you always start again at the beginning.</p>
        {% else %}
            <span class="bg-info p-2 d-flex fitcontent mt-5">Save your progress -><a class="text-primary" href="{% url 'auth:login' %}"> Log in</a></span>
        {% endif %} 
    </div>
    <div id="embvid" class="embeded-video">
        <div id="blur">
            <div id="player"></div>
        </div>
    </div>
    <div id="text-area" class="text-area">
        
        <div id="tip" class="tip"></div>
    <div id="counter-cont" class="d-flex justify-content-between counter-cont">
        <button type="button" title="previous" id="previous" class="btn btn-sm active border-0 mb-3 mt-3">
            <i class="fa-solid fa-left-long" style="transform: scale(3,3);"></i>
        </button>                
        <div class="d-flex align-content-center align-items-center rounded mb-3 mt-3">
            <span id="counter"> {{ line_nb }} </span> / {{total_lines}}
        </div>
        <button type="button" title="next" id="go-next" class="btn btn-sm active border-0 mb-3 mt-3">
            <i class="fa-solid fa-right-long" style="transform: scale(3,3);"></i>
        </button>                
    </div> 
    {{form}}
    <div class="d-flex justify-content-between rounded bg-white mt-3">
        <div class="d-flex align-items-center p-2">
            <button type="button" class="btn btn-outline-secondary  ms-1" title="play" id="replay"><i id="iplaystop" class="fa-solid fa-play"></i></button>
            <button type="button" class="btn btn-primary ms-1" title="check" id="check"><i class="fa-solid fa-check"></i></button>
            <button type="button" class="btn btn-warning ms-1" title="reveal first letter" id="reveal"> <i class="fa-solid fa-0"></i></button> 
            <button type="button" id="blur-btn" class="btn btn-outline-secondary ms-1" title="Blur video"><i id="iblur" class="fa-solid fa-droplet"></i></button>
        </div>            
            <span id="complete" class="d-flex p-2"></span>
    </div>
        <br>
        <p> {{result}} </p>
        <p>Correction:</p><br>
        <img id="imgb64" src='data:image/jpeg;base64,{{ b64_img }}' alt="poster" hidden>
        <div id="result_correction" class="text-entry"></div>
    </div>
    <div id="bonus-txt" class="bonus-txt">
        <h4>The story until the last validated segment</h4>
        <div id="bonus-container" class="bonus-container">
            <div>
                <ul id="story-segment"></ul>
            </div>
        </div>
        {% if user.is_authenticated %}
        <script>const dictation_id = {{ dictation_id }};</script>
        {% else %}
        <script>const dictation_id = null;</script>
        {% endif %}
    </div>
    {% endspaceless %}
    <script>
        const aptc = "{% url 'dictation:ajax_post_textarea_content' %}",
            aprr = "{% url 'dictation:ajax_post_request_rating' %}",
            topicname = '{{ topic_name }}',
            vid = '{{ video_id }}',
            b64_img = '{{ b64_img }}',
            totl = {{ total_lines }},
            ts = {{ timestamps }},
            tips = {{ help|safe }};
        var lineNb = {{ line_nb }},
            implines = {{ lines }},
            lines = [];
        lines = implines 
    </script>
    <script src="{% static 'js/topic.js' %}"></script>
    <script src="{% static 'js/assets/scripts/topic/index.bundle.js' %}"></script>
{% endblock index %}